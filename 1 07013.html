<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Практическое занятие 2 - Назначение ролей сервера и базы данных</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --light-color: #ecf0f1;
            --dark-color: #34495e;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
            color: #333;
            line-height: 1.6;
        }
        
        .navbar {
            background: linear-gradient(135deg, var(--primary-color), var(--dark-color));
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .sidebar {
            background-color: var(--light-color);
            border-right: 1px solid #dee2e6;
            height: 100vh;
            position: sticky;
            top: 0;
            overflow-y: auto;
        }
        
        .sidebar .nav-link {
            color: var(--dark-color);
            border-radius: 0.375rem;
            margin-bottom: 0.25rem;
            transition: all 0.3s;
        }
        
        .sidebar .nav-link:hover, .sidebar .nav-link.active {
            background-color: var(--secondary-color);
            color: white;
        }
        
        .section {
            padding: 2rem 0;
            border-bottom: 1px solid #e9ecef;
        }
        
        .section:last-child {
            border-bottom: none;
        }
        
        .card {
            border: none;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: transform 0.3s, box-shadow 0.3s;
            margin-bottom: 1.5rem;
            border-radius: 0.5rem;
            overflow: hidden;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.15);
        }
        
        .card-header {
            background: linear-gradient(135deg, var(--secondary-color), #2980b9);
            color: white;
            font-weight: 600;
            border-bottom: none;
        }
        
        .code-block {
            background-color: #2d3748;
            color: #e2e8f0;
            border-radius: 0.375rem;
            padding: 1rem;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            overflow-x: auto;
            margin: 1rem 0;
        }
        
        .sql-keyword {
            color: #f56565;
            font-weight: bold;
        }
        
        .sql-string {
            color: #68d391;
        }
        
        .sql-comment {
            color: #a0aec0;
            font-style: italic;
        }
        
        .hierarchy-level {
            padding: 0.75rem 1rem;
            margin: 0.5rem 0;
            border-radius: 0.375rem;
            font-weight: 600;
            text-align: center;
        }
        
        .task-number {
            display: inline-block;
            width: 30px;
            height: 30px;
            background-color: var(--secondary-color);
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 30px;
            margin-right: 10px;
            font-weight: bold;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--secondary-color), #2980b9);
            border: none;
            border-radius: 0.375rem;
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, #2980b9, var(--secondary-color));
            transform: translateY(-2px);
        }
        
        .objective-card {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            border-left: 4px solid var(--secondary-color);
        }
        
        .prerequisite-card {
            background: linear-gradient(135deg, #f3e5f5, #e1bee7);
            border-left: 4px solid #9c27b0;
        }
        
        .hint {
            background-color: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 0.375rem;
        }
        
        .scroll-top {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: var(--secondary-color);
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            cursor: pointer;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .scroll-top.show {
            opacity: 1;
        }
        
        @media (max-width: 768px) {
            .sidebar {
                height: auto;
                position: relative;
            }
            
            .section {
                padding: 1.5rem 0;
            }
        }
    </style>
</head>
<body>
    <!-- Навигационная панель -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="fas fa-database me-2"></i>МДК.07.01 - Управление и автоматизация баз данных
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarContent">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="#introduction"><i class="fas fa-info-circle me-1"></i>Введение</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#tasks"><i class="fas fa-tasks me-1"></i>Задания</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#resources"><i class="fas fa-book me-1"></i>Ресурсы</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- Боковая панель -->
            <div class="col-lg-2 col-md-3 sidebar p-0">
                <div class="p-3">
                    <h5 class="mb-3">Навигация по занятию</h5>
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link active" href="#introduction"><i class="fas fa-play-circle me-2"></i>Введение</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#theory"><i class="fas fa-book me-2"></i>Теоретическая часть</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#preparation"><i class="fas fa-tools me-2"></i>Подготовка среды</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#task1"><i class="fas fa-database me-2"></i>Задание 1: Логины и пользователи</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#task2"><i class="fas fa-user-shield me-2"></i>Задание 2: Системные роли</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#task3"><i class="fas fa-users-cog me-2"></i>Задание 3: Пользовательские роли</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#task4"><i class="fas fa-lock me-2"></i>Задание 4: Управление разрешениями</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#independent"><i class="fas fa-user-graduate me-2"></i>Самостоятельная работа</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#conclusion"><i class="fas fa-flag-checkered me-2"></i>Заключение</a>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Основной контент -->
            <main class="col-lg-10 col-md-9 ms-sm-auto px-4 py-4">
                <!-- Введение -->
                <section id="introduction" class="section">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h1 class="display-5 fw-bold">Практическое занятие 2</h1>
                        <span class="badge bg-primary fs-6">МДК.07.01</span>
                    </div>
                    <h2 class="mb-3">Назначение ролей сервера и базы данных</h2>
                    
                    <div class="row mb-4">
                        <div class="col-md-8">
                            <div class="card objective-card">
                                <div class="card-body">
                                    <h4><i class="fas fa-bullseye me-2"></i>Цель работы</h4>
                                    <p class="mb-0">Освоить методы управления ролями и разрешениями на уровне сервера и базы данных в СУБД, научиться создавать и назначать роли, управлять доступом к объектам базы данных.</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card">
                                <div class="card-header">
                                    <i class="fas fa-clock me-2"></i>Время выполнения
                                </div>
                                <div class="card-body text-center">
                                    <h3 class="text-primary">2 часа</h3>
                                    <p class="mb-0">академических часа</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card prerequisite-card">
                        <div class="card-body">
                            <h5><i class="fas fa-clipboard-check me-2"></i>Необходимые знания и инструменты</h5>
                            <div class="row">
                                <div class="col-md-6">
                                    <ul>
                                        <li>Установленная СУБД (MS SQL Server, PostgreSQL или MySQL)</li>
                                        <li>Средство управления БД (SSMS, pgAdmin, MySQL Workbench)</li>
                                        <li>Базовые знания SQL (CREATE, ALTER, GRANT, REVOKE)</li>
                                    </ul>
                                </div>
                                <div class="col-md-6">
                                    <ul>
                                        <li>Понимание концепций аутентификации и авторизации</li>
                                        <li>Знание основных объектов базы данных</li>
                                        <li>Умение выполнять простые запросы SELECT, INSERT, UPDATE</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Теоретическая часть -->
                <section id="theory" class="section">
                    <h2 class="mb-4"><i class="fas fa-book me-2"></i>Теоретическая часть</h2>
                    
                    <div class="row">
                        <div class="col-lg-6">
                            <div class="card">
                                <div class="card-header">
                                    <i class="fas fa-sitemap me-2"></i>Иерархия управления доступом в СУБД
                                </div>
                                <div class="card-body">
                                    <div class="hierarchy-level bg-danger text-white">СЕРВЕР БД (Логины)</div>
                                    <div class="hierarchy-level bg-warning text-dark">БАЗЫ ДАННЫХ (Пользователи)</div>
                                    <div class="hierarchy-level bg-info text-white">СХЕМЫ</div>
                                    <div class="hierarchy-level bg-success text-white">ТАБЛИЦЫ/ПРОЦЕДУРЫ</div>
                                    <div class="hierarchy-level bg-secondary text-white">СТОЛБЦЫ/СТРОКИ</div>
                                    
                                    <div class="mt-3">
                                        <p><strong>Логин (Login)</strong> - учетная запись для подключения к серверу БД.</p>
                                        <p><strong>Пользователь (User)</strong> - сопоставление логина с конкретной базой данных.</p>
                                        <p><strong>Роль (Role)</strong> - группа разрешений, которые можно назначить пользователям.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-lg-6">
                            <div class="card">
                                <div class="card-header">
                                    <i class="fas fa-user-tag me-2"></i>Основные системные роли СУБД
                                </div>
                                <div class="card-body">
                                    <h6>Роли уровня сервера (на примере SQL Server):</h6>
                                    <ul>
                                        <li><code>sysadmin</code> - полный контроль над сервером</li>
                                        <li><code>securityadmin</code> - управление безопасностью и доступом</li>
                                        <li><code>serveradmin</code> - настройка параметров сервера</li>
                                        <li><code>dbcreator</code> - создание и изменение баз данных</li>
                                        <li><code>processadmin</code> - управление процессами сервера</li>
                                    </ul>
                                    
                                    <h6 class="mt-3">Роли уровня базы данных:</h6>
                                    <ul>
                                        <li><code>db_owner</code> - полный контроль в рамках БД</li>
                                        <li><code>db_datareader</code> - чтение данных из всех таблиц</li>
                                        <li><code>db_datawriter</code> - изменение данных во всех таблицах</li>
                                        <li><code>db_ddladmin</code> - выполнение DDL-команд (CREATE, ALTER, DROP)</li>
                                        <li><code>db_securityadmin</code> - управление разрешениями и ролями БД</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Подготовка среды -->
                <section id="preparation" class="section">
                    <h2 class="mb-4"><i class="fas fa-tools me-2"></i>Подготовка рабочей среды</h2>
                    
                    <div class="card">
                        <div class="card-header">
                            <span class="task-number">0</span> Создание тестовой базы данных и таблиц
                        </div>
                        <div class="card-body">
                            <p>Перед началом работы создадим тестовую базу данных "University" и необходимые таблицы.</p>
                            
                            <div class="code-block">
<span class="sql-keyword">CREATE DATABASE</span> University;<br>
<span class="sql-keyword">GO</span><br>
<span class="sql-keyword">USE</span> University;<br>
<br>
<span class="sql-comment">-- Создание таблицы Студенты</span><br>
<span class="sql-keyword">CREATE TABLE</span> Students (<br>
&nbsp;&nbsp;&nbsp;&nbsp;StudentID <span class="sql-keyword">INT PRIMARY KEY</span>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;Name <span class="sql-keyword">NVARCHAR</span>(50),<br>
&nbsp;&nbsp;&nbsp;&nbsp;GroupName <span class="sql-keyword">NVARCHAR</span>(20)<br>
);<br>
<br>
<span class="sql-comment">-- Создание таблицы Оценки</span><br>
<span class="sql-keyword">CREATE TABLE</span> Grades (<br>
&nbsp;&nbsp;&nbsp;&nbsp;GradeID <span class="sql-keyword">INT PRIMARY KEY</span>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;StudentID <span class="sql-keyword">INT REFERENCES</span> Students(StudentID),<br>
&nbsp;&nbsp;&nbsp;&nbsp;Subject <span class="sql-keyword">NVARCHAR</span>(50),<br>
&nbsp;&nbsp;&nbsp;&nbsp;Grade <span class="sql-keyword">INT</span><br>
);<br>
<br>
<span class="sql-comment">-- Добавление тестовых данных</span><br>
<span class="sql-keyword">INSERT INTO</span> Students <span class="sql-keyword">VALUES</span> <br>
(1, <span class="sql-string">'Иванов Алексей'</span>, <span class="sql-string">'ИТ-101'</span>),<br>
(2, <span class="sql-string">'Петрова Мария'</span>, <span class="sql-string">'ИТ-101'</span>),<br>
(3, <span class="sql-string">'Сидоров Дмитрий'</span>, <span class="sql-string">'ИТ-102'</span>);<br>
<br>
<span class="sql-keyword">INSERT INTO</span> Grades <span class="sql-keyword">VALUES</span> <br>
(1, 1, <span class="sql-string">'Базы данных'</span>, 5),<br>
(2, 1, <span class="sql-string">'Программирование'</span>, 4),<br>
(3, 2, <span class="sql-string">'Базы данных'</span>, 4);
                            </div>
                            
                            <div class="hint">
                                <i class="fas fa-lightbulb me-2"></i><strong>Подсказка:</strong> Если вы используете PostgreSQL или MySQL, синтаксис может незначительно отличаться. Например, в PostgreSQL вместо <code>NVARCHAR</code> используется <code>VARCHAR</code>, а вместо <code>GO</code> используется точка с запятой.
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Задание 1 -->
                <section id="task1" class="section">
                    <div class="card">
                        <div class="card-header">
                            <span class="task-number">1</span> Создание логинов сервера и пользователей базы данных
                        </div>
                        <div class="card-body">
                            <p>В этом задании мы создадим логины для доступа к серверу БД и сопоставим их с пользователями в нашей тестовой базе данных.</p>
                            
                            <h5>Шаг 1: Создание логинов сервера</h5>
                            <div class="code-block">
<span class="sql-comment">-- Создание логинов с аутентификацией по паролю</span><br>
<span class="sql-keyword">CREATE LOGIN</span> admin_user <span class="sql-keyword">WITH PASSWORD</span> = <span class="sql-string">'Admin123!'</span>;<br>
<span class="sql-keyword">CREATE LOGIN</span> teacher_user <span class="sql-keyword">WITH PASSWORD</span> = <span class="sql-string">'Teacher123!'</span>;<br>
<span class="sql-keyword">CREATE LOGIN</span> student_user <span class="sql-keyword">WITH PASSWORD</span> = <span class="sql-string">'Student123!'</span>;<br>
<span class="sql-keyword">CREATE LOGIN</span> auditor_user <span class="sql-keyword">WITH PASSWORD</span> = <span class="sql-string">'Auditor123!'</span>;
                            </div>
                            
                            <h5 class="mt-4">Шаг 2: Создание пользователей в базе данных University</h5>
                            <div class="code-block">
<span class="sql-keyword">USE</span> University;<br>
<br>
<span class="sql-comment">-- Сопоставление логинов с пользователями базы данных</span><br>
<span class="sql-keyword">CREATE USER</span> admin_user <span class="sql-keyword">FOR LOGIN</span> admin_user;<br>
<span class="sql-keyword">CREATE USER</span> teacher_user <span class="sql-keyword">FOR LOGIN</span> teacher_user;<br>
<span class="sql-keyword">CREATE USER</span> student_user <span class="sql-keyword">FOR LOGIN</span> student_user;<br>
<span class="sql-keyword">CREATE USER</span> auditor_user <span class="sql-keyword">FOR LOGIN</span> auditor_user;
                            </div>
                            
                            <div class="hint">
                                <i class="fas fa-lightbulb me-2"></i><strong>Важно:</strong> Логин предоставляет доступ к серверу БД, а пользователь - к конкретной базе данных. Один логин может быть сопоставлен с пользователями в разных базах данных.
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Задание 2 -->
                <section id="task2" class="section">
                    <div class="card">
                        <div class="card-header">
                            <span class="task-number">2</span> Назначение системных ролей базы данных
                        </div>
                        <div class="card-body">
                            <p>Теперь назначим созданным пользователям соответствующие системные роли базы данных в соответствии с их функциями.</p>
                            
                            <div class="code-block">
<span class="sql-keyword">USE</span> University;<br>
<br>
<span class="sql-comment">-- Администратор получает полные права на базу данных</span><br>
<span class="sql-keyword">ALTER ROLE</span> db_owner <span class="sql-keyword">ADD MEMBER</span> admin_user;<br>
<br>
<span class="sql-comment">-- Преподаватель может читать и изменять данные</span><br>
<span class="sql-keyword">ALTER ROLE</span> db_datareader <span class="sql-keyword">ADD MEMBER</span> teacher_user;<br>
<span class="sql-keyword">ALTER ROLE</span> db_datawriter <span class="sql-keyword">ADD MEMBER</span> teacher_user;<br>
<br>
<span class="sql-comment">-- Студент может только читать данные</span><br>
<span class="sql-keyword">ALTER ROLE</span> db_datareader <span class="sql-keyword">ADD MEMBER</span> student_user;<br>
<br>
<span class="sql-comment">-- Аудитор может только читать данные (для проверки)</span><br>
<span class="sql-keyword">ALTER ROLE</span> db_datareader <span class="sql-keyword">ADD MEMBER</span> auditor_user;
                            </div>
                            
                            <div class="mt-4">
                                <h5>Проверка назначенных ролей</h5>
                                <p>Убедимся, что роли назначены правильно, выполнив запрос к системному представлению:</p>
                                
                                <div class="code-block">
<span class="sql-comment">-- Просмотр пользователей и их ролей в текущей базе данных</span><br>
<span class="sql-keyword">SELECT</span> <br>
&nbsp;&nbsp;&nbsp;&nbsp;dp.name <span class="sql-keyword">AS</span> principal_name,<br>
&nbsp;&nbsp;&nbsp;&nbsp;dp.type_desc <span class="sql-keyword">AS</span> principal_type,<br>
&nbsp;&nbsp;&nbsp;&nbsp;r.name <span class="sql-keyword">AS</span> role_name<br>
<span class="sql-keyword">FROM</span> sys.database_principals dp<br>
<span class="sql-keyword">LEFT JOIN</span> sys.database_role_members rm <span class="sql-keyword">ON</span> dp.principal_id = rm.member_principal_id<br>
<span class="sql-keyword">LEFT JOIN</span> sys.database_principals r <span class="sql-keyword">ON</span> rm.role_principal_id = r.principal_id<br>
<span class="sql-keyword">WHERE</span> dp.name <span class="sql-keyword">IN</span> (<span class="sql-string">'admin_user'</span>, <span class="sql-string">'teacher_user'</span>, <span class="sql-string">'student_user'</span>, <span class="sql-string">'auditor_user'</span>);
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Задание 3 -->
                <section id="task3" class="section">
                    <div class="card">
                        <div class="card-header">
                            <span class="task-number">3</span> Создание и настройка пользовательских ролей
                        </div>
                        <div class="card-body">
                            <p>Создадим специализированные пользовательские роли для более точного управления доступом.</p>
                            
                            <h5>Шаг 1: Создание пользовательских ролей</h5>
                            <div class="code-block">
<span class="sql-comment">-- Создание роли для управления оценками</span><br>
<span class="sql-keyword">CREATE ROLE</span> GradeManager;<br>
<br>
<span class="sql-comment">-- Создание роли для просмотра информации о студентах</span><br>
<span class="sql-keyword">CREATE ROLE</span> StudentViewer;<br>
<br>
<span class="sql-comment">-- Создание роли для генерации отчетов</span><br>
<span class="sql-keyword">CREATE ROLE</span> ReportGenerator;
                            </div>
                            
                            <h5 class="mt-4">Шаг 2: Назначение разрешений ролям</h5>
                            <div class="code-block">
<span class="sql-comment">-- Роль GradeManager может управлять оценками</span><br>
<span class="sql-keyword">GRANT SELECT, INSERT, UPDATE, DELETE ON</span> Grades <span class="sql-keyword">TO</span> GradeManager;<br>
<br>
<span class="sql-comment">-- Роль StudentViewer может просматривать информацию о студентах</span><br>
<span class="sql-keyword">GRANT SELECT ON</span> Students <span class="sql-keyword">TO</span> StudentViewer;<br>
<br>
<span class="sql-comment">-- Роль ReportGenerator может выполнять SELECT для генерации отчетов</span><br>
<span class="sql-keyword">GRANT SELECT ON</span> Students <span class="sql-keyword">TO</span> ReportGenerator;<br>
<span class="sql-keyword">GRANT SELECT ON</span> Grades <span class="sql-keyword">TO</span> ReportGenerator;
                            </div>
                            
                            <h5 class="mt-4">Шаг 3: Назначение пользователей ролям</h5>
                            <div class="code-block">
<span class="sql-comment">-- Преподаватель получает роль управления оценками</span><br>
<span class="sql-keyword">ALTER ROLE</span> GradeManager <span class="sql-keyword">ADD MEMBER</span> teacher_user;<br>
<br>
<span class="sql-comment">-- Студент получает роль просмотра информации</span><br>
<span class="sql-keyword">ALTER ROLE</span> StudentViewer <span class="sql-keyword">ADD MEMBER</span> student_user;<br>
<br>
<span class="sql-comment">-- Аудитор получает роль генератора отчетов</span><br>
<span class="sql-keyword">ALTER ROLE</span> ReportGenerator <span class="sql-keyword">ADD MEMBER</span> auditor_user;
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Задание 4 -->
                <section id="task4" class="section">
                    <div class="card">
                        <div class="card-header">
                            <span class="task-number">4</span> Управление разрешениями на уровне объектов
                        </div>
                        <div class="card-body">
                            <p>Настроим более детальные разрешения, используя механизмы предоставления и запрета прав доступа.</p>
                            
                            <h5>Шаг 1: Создание представления для ограниченного доступа</h5>
                            <div class="code-block">
<span class="sql-comment">-- Создание представления, которое показывает только оценки студентов группы ИТ-101</span><br>
<span class="sql-keyword">CREATE VIEW</span> vw_IT101_Grades <span class="sql-keyword">AS</span><br>
<span class="sql-keyword">SELECT</span> s.StudentID, s.Name, g.Subject, g.Grade<br>
<span class="sql-keyword">FROM</span> Students s<br>
<span class="sql-keyword">JOIN</span> Grades g <span class="sql-keyword">ON</span> s.StudentID = g.StudentID<br>
<span class="sql-keyword">WHERE</span> s.GroupName = <span class="sql-string">'ИТ-101'</span>;<br>
<br>
<span class="sql-comment">-- Предоставление прав на представление студентам</span><br>
<span class="sql-keyword">GRANT SELECT ON</span> vw_IT101_Grades <span class="sql-keyword">TO</span> StudentViewer;
                            </div>
                            
                            <h5 class="mt-4">Шаг 2: Запрет прямого доступа к таблице оценок</h5>
                            <div class="code-block">
<span class="sql-comment">-- Запрещаем студентам прямой доступ к таблице оценок</span><br>
<span class="sql-keyword">DENY SELECT ON</span> Grades <span class="sql-keyword">TO</span> student_user;<br>
<br>
<span class="sql-comment">-- Но разрешаем доступ через роль StudentViewer к представлению</span><br>
<span class="sql-keyword">GRANT SELECT ON</span> vw_IT101_Grades <span class="sql-keyword">TO</span> StudentViewer;
                            </div>
                            
                            <h5 class="mt-4">Шаг 3: Создание хранимой процедуры и предоставление прав на выполнение</h5>
                            <div class="code-block">
<span class="sql-comment">-- Создание процедуры для добавления новых студентов</span><br>
<span class="sql-keyword">CREATE PROCEDURE</span> sp_AddStudent<br>
&nbsp;&nbsp;&nbsp;&nbsp;@StudentID <span class="sql-keyword">INT</span>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;@Name <span class="sql-keyword">NVARCHAR</span>(50),<br>
&nbsp;&nbsp;&nbsp;&nbsp;@GroupName <span class="sql-keyword">NVARCHAR</span>(20)<br>
<span class="sql-keyword">AS</span><br>
<span class="sql-keyword">BEGIN</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">INSERT INTO</span> Students (StudentID, Name, GroupName)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">VALUES</span> (@StudentID, @Name, @GroupName);<br>
<span class="sql-keyword">END</span>;<br>
<br>
<span class="sql-comment">-- Предоставление прав на выполнение процедуры преподавателям</span><br>
<span class="sql-keyword">GRANT EXECUTE ON</span> sp_AddStudent <span class="sql-keyword">TO</span> teacher_user;
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Самостоятельная работа -->
                <section id="independent" class="section">
                    <h2 class="mb-4"><i class="fas fa-user-graduate me-2"></i>Самостоятельная работа</h2>
                    
                    <div class="card">
                        <div class="card-header bg-warning text-dark">
                            <i class="fas fa-pencil-alt me-2"></i>Задания для самостоятельного выполнения
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="card mb-3">
                                        <div class="card-body">
                                            <h5>Задание 1</h5>
                                            <p>Создайте логин "secretary_user" и предоставьте ему права на добавление новых студентов, но без возможности просматривать или изменять оценки.</p>
                                            <button class="btn btn-sm btn-outline-primary" data-bs-toggle="collapse" data-bs-target="#solution1">Решение</button>
                                            <div id="solution1" class="collapse mt-2">
                                                <div class="code-block">
<span class="sql-keyword">CREATE LOGIN</span> secretary_user <span class="sql-keyword">WITH PASSWORD</span> = <span class="sql-string">'Secretary123!'</span>;<br>
<span class="sql-keyword">USE</span> University;<br>
<span class="sql-keyword">CREATE USER</span> secretary_user <span class="sql-keyword">FOR LOGIN</span> secretary_user;<br>
<span class="sql-keyword">GRANT INSERT ON</span> Students <span class="sql-keyword">TO</span> secretary_user;<br>
<span class="sql-keyword">DENY SELECT, UPDATE, DELETE ON</span> Students <span class="sql-keyword">TO</span> secretary_user;<br>
<span class="sql-keyword">DENY ALL ON</span> Grades <span class="sql-keyword">TO</span> secretary_user;
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="card mb-3">
                                        <div class="card-body">
                                            <h5>Задание 2</h5>
                                            <p>Создайте представление, которое показывает средний балл по каждому предмету, и предоставьте доступ к нему только аудиторам.</p>
                                            <button class="btn btn-sm btn-outline-primary" data-bs-toggle="collapse" data-bs-target="#solution2">Решение</button>
                                            <div id="solution2" class="collapse mt-2">
                                                <div class="code-block">
<span class="sql-comment">-- Создание представления со средними баллами</span><br>
<span class="sql-keyword">CREATE VIEW</span> vw_SubjectAverages <span class="sql-keyword">AS</span><br>
<span class="sql-keyword">SELECT</span> Subject, <span class="sql-keyword">AVG</span>(Grade) <span class="sql-keyword">AS</span> AverageGrade<br>
<span class="sql-keyword">FROM</span> Grades<br>
<span class="sql-keyword">GROUP BY</span> Subject;<br>
<br>
<span class="sql-comment">-- Предоставление прав только аудиторам</span><br>
<span class="sql-keyword">GRANT SELECT ON</span> vw_SubjectAverages <span class="sql-keyword">TO</span> auditor_user;<br>
<span class="sql-keyword">DENY SELECT ON</span> vw_SubjectAverages <span class="sql-keyword">TO</span> student_user, teacher_user;
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="card mb-3">
                                        <div class="card-body">
                                            <h5>Задание 3</h5>
                                            <p>Реализуйте безопасность на уровне строк, чтобы преподаватели могли видеть только студентов своей группы.</p>
                                            <button class="btn btn-sm btn-outline-primary" data-bs-toggle="collapse" data-bs-target="#solution3">Решение</button>
                                            <div id="solution3" class="collapse mt-2">
                                                <div class="code-block">
<span class="sql-comment">-- Создание функции безопасности</span><br>
<span class="sql-keyword">CREATE FUNCTION</span> fn_TeacherGroupFilter(@GroupName <span class="sql-keyword">NVARCHAR</span>(20))<br>
<span class="sql-keyword">RETURNS TABLE</span><br>
<span class="sql-keyword">WITH SCHEMABINDING</span><br>
<span class="sql-keyword">AS</span><br>
<span class="sql-keyword">RETURN SELECT</span> 1 <span class="sql-keyword">AS</span> fn_securitypredicate_result<br>
<span class="sql-keyword">WHERE</span> @GroupName = <span class="sql-keyword">SESSION_CONTEXT</span>(N'GroupName');<br>
<br>
<span class="sql-comment">-- Создание политики безопасности</span><br>
<span class="sql-keyword">CREATE SECURITY POLICY</span> TeacherGroupPolicy<br>
<span class="sql-keyword">ADD FILTER PREDICATE</span> dbo.fn_TeacherGroupFilter(GroupName) <span class="sql-keyword">ON</span> dbo.Students;<br>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="card mb-3">
                                        <div class="card-body">
                                            <h5>Задание 4</h5>
                                            <p>Создайте роль "BackupOperator" с правами на создание резервных копий базы данных.</p>
                                            <button class="btn btn-sm btn-outline-primary" data-bs-toggle="collapse" data-bs-target="#solution4">Решение</button>
                                            <div id="solution4" class="collapse mt-2">
                                                <div class="code-block">
<span class="sql-comment">-- На уровне сервера (выполняется в контексте master)</span><br>
<span class="sql-keyword">USE</span> master;<br>
<span class="sql-keyword">CREATE LOGIN</span> backup_operator <span class="sql-keyword">WITH PASSWORD</span> = <span class="sql-string">'Backup123!'</span>;<br>
<span class="sql-keyword">ALTER SERVER ROLE</span> dbcreator <span class="sql-keyword">ADD MEMBER</span> backup_operator;<br>
<br>
<span class="sql-comment">-- На уровне базы данных</span><br>
<span class="sql-keyword">USE</span> University;<br>
<span class="sql-keyword">CREATE USER</span> backup_operator <span class="sql-keyword">FOR LOGIN</span> backup_operator;<br>
<span class="sql-keyword">ALTER ROLE</span> db_backupoperator <span class="sql-keyword">ADD MEMBER</span> backup_operator;
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Заключение -->
                <section id="conclusion" class="section">
                    <h2 class="mb-4"><i class="fas fa-flag-checkered me-2"></i>Заключение</h2>
                    
                    <div class="card">
                        <div class="card-header bg-success text-white">
                            <i class="fas fa-check-circle me-2"></i>Итоги практического занятия
                        </div>
                        <div class="card-body">
                            <h5>Что мы освоили:</h5>
                            <ul>
                                <li>Создание логинов сервера и пользователей базы данных</li>
                                <li>Назначение системных ролей уровня сервера и базы данных</li>
                                <li>Создание и настройка пользовательских ролей</li>
                                <li>Управление разрешениями на уровне объектов (таблиц, представлений, процедур)</li>
                                <li>Использование механизмов предоставления и запрета прав доступа</li>
                            </ul>
                            
                            <h5 class="mt-4">Контрольные вопросы:</h5>
                            <ol>
                                <li>В чем разница между логином и пользователем базы данных?</li>
                                <li>Какие системные роли позволяют создавать резервные копии базы данных?</li>
                                <li>Как ограничить доступ пользователя только к определенным столбцам таблицы?</li>
                                <li>Что такое принцип минимальных привилегий и почему он важен?</li>
                                <li>Как отозвать ранее выданные разрешения?</li>
                            </ol>
                            
                            <div class="alert alert-info mt-4">
                                <h6><i class="fas fa-lightbulb me-2"></i>Рекомендации для дальнейшего изучения:</h6>
                                <ul class="mb-0">
                                    <li>Изучите безопасность на уровне строк (Row-Level Security)</li>
                                    <li>Освойте динамическое маскирование данных (Dynamic Data Masking)</li>
                                    <li>Изучите Always Encrypted для защиты конфиденциальных данных</li>
                                    <li>Практикуйтесь в создании сложных политик безопасности</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </section>
            </main>
        </div>
    </div>

    <!-- Кнопка прокрутки вверх -->
    <div class="scroll-top" id="scrollTop">
        <i class="fas fa-arrow-up"></i>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Прокрутка к верху страницы
        document.getElementById('scrollTop').addEventListener('click', function() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });
        
        // Показать/скрыть кнопку прокрутки
        window.addEventListener('scroll', function() {
            const scrollTop = document.getElementById('scrollTop');
            if (window.pageYOffset > 300) {
                scrollTop.classList.add('show');
            } else {
                scrollTop.classList.remove('show');
            }
        });
        
        // Подсветка активного раздела в навигации
        const sections = document.querySelectorAll('section');
        const navLinks = document.querySelectorAll('.sidebar .nav-link');
        
        window.addEventListener('scroll', function() {
            let current = '';
            
            sections.forEach(section => {
                const sectionTop = section.offsetTop;
                const sectionHeight = section.clientHeight;
                if (pageYOffset >= sectionTop - 100) {
                    current = section.getAttribute('id');
                }
            });
            
            navLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href').substring(1) === current) {
                    link.classList.add('active');
                }
            });
        });
    </script>
</body>
</html>